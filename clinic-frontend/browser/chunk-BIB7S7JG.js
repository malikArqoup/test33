import{Ra as u}from"./chunk-HGQWQHZI.js";import{Ac as s,Y as l,ba as c,j as o,r as n}from"./chunk-VLGNHA3U.js";var m=class a{constructor(r,t){this.http=r;this.clinicService=t;this.checkStoredUser()}currentUserSubject=new o(null);currentUser$=this.currentUserSubject.asObservable();checkStoredUser(){let r=localStorage.getItem("access_token"),t=localStorage.getItem("user_data");if(r&&t)try{let e=JSON.parse(t);this.currentUserSubject.next(e)}catch{this.logout()}}login(r,t){return this.clinicService.login(r,t).pipe(n(e=>{let i={id:e.id,name:e.name,email:e.email,phone_number:e.phone_number,age:e.age,gender:e.gender,role:e.role};return localStorage.setItem("access_token",e.access_token),localStorage.setItem("user_data",JSON.stringify(i)),this.currentUserSubject.next(i),i}))}adminLogin(r,t){return this.clinicService.adminLogin(r,t).pipe(n(e=>{let i={id:e.id,name:e.name,email:e.email,phone_number:e.phone_number,age:e.age,gender:e.gender,role:e.role};return localStorage.setItem("access_token",e.access_token),localStorage.setItem("user_data",JSON.stringify(i)),this.currentUserSubject.next(i),i}))}register(r){return this.clinicService.register(r).pipe(n(t=>{let e={id:t.id,name:t.name,email:t.email,phone_number:t.phone_number,age:t.age,gender:t.gender,role:t.role};return localStorage.setItem("access_token",t.access_token),localStorage.setItem("user_data",JSON.stringify(e)),this.currentUserSubject.next(e),e}))}logout(){localStorage.removeItem("access_token"),localStorage.removeItem("user_data"),this.currentUserSubject.next(null)}getCurrentUser(){return this.currentUserSubject.value}isLoggedIn(){return this.currentUserSubject.value!==null}isAdmin(){return this.getCurrentUser()?.role==="admin"}isPatient(){return this.getCurrentUser()?.role==="patient"}getToken(){return localStorage.getItem("access_token")}refreshUserData(){return this.clinicService.getCurrentUser().pipe(n(r=>{let t={id:r.id,name:r.name,email:r.email,phone_number:r.phone_number,age:r.age,gender:r.gender,role:r.role};return localStorage.setItem("user_data",JSON.stringify(t)),this.currentUserSubject.next(t),t}))}static \u0275fac=function(t){return new(t||a)(c(s),c(u))};static \u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"})};export{m as a};
